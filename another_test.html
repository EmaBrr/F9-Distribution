<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Open+Sans:wght@300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300..700&family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
    <!-- Icons -->
    <script src="https://kit.fontawesome.com/ac6953d5aa.js" crossorigin="anonymous" defer></script>
    <!-- Fullpage -->
    <link rel="stylesheet" type="text/css" href="https://www.unpkg.com/fullpage.js/dist/fullpage.min.css" />
    <!-- Style -->
    <link rel="stylesheet" href="./style/app.css" />
    <!-- JS code -->
    <script src="./js/main.js" defer></script>
    <!-- Map  -->
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <link href="./dist/svgMap.css" rel="stylesheet" />
    <script src="./dist/svgMap.js"></script>
    <title>F9 Distribution Defence</title>
</head>

<body>
    <!-- Navigation -->
    <header></header>

    <div id="fullpage">

        <div class="section" id="section-map">
            <div class="item">
                <div class="item-container">
                    <!-- Add any content you want for the first section here -->
                </div>
            </div>
        </div>

        <!-- Map Preview Section -->
        <div class="section" id="section-map-preview">
            <div class="item">
                <div class="item-container">
                    <span>Where Our Brands Operate</span>
                    <h1>Brands Across Countries</h1>

                    <!-- Map preview section with an image thumbnail -->
                    <div id="mapPreview" class="map-preview" onclick="expandMap()">
                        <img src="./img/Parrot-army-drone.jpeg" alt="Map Preview" style="width: 100%; height: auto;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Map modal for interactive map -->
        <div id="mapModal" class="map-modal" style="display: none;">
            <span class="close" onclick="closeMap()">&times;</span>
            <div id="mapContainer">
                <div class="demo-wrapper">
                    <div class="demo-container">
                        <div id="svgMapBrand"></div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Ensure elements exist before adding event listeners
                const svgMapBrandElement = document.getElementById('svgMapBrand');

                if (svgMapBrandElement) {
                    svgMapBrandElement.addEventListener('mouseenter', function () {
                        fullpage_api.setAllowScrolling(false);
                    });

                    svgMapBrandElement.addEventListener('mouseleave', function () {
                        fullpage_api.setAllowScrolling(true);
                    });
                }
            });

            // Function to open the modal and initialize the map
            function expandMap() {
                const mapModal = document.getElementById('mapModal');
                if (mapModal) {
                    mapModal.style.display = 'block'; // Show the modal
                    fullpage_api.setAllowScrolling(false); // Disable scrolling in fullPage.js

                    // Delay map initialization slightly to ensure modal is fully displayed
                    setTimeout(initializeMap, 100);
                }
            }

            // Function to close the modal
            function closeMap() {
                const mapModal = document.getElementById('mapModal');
                if (mapModal) {
                    mapModal.style.display = 'none'; // Hide the modal
                    fullpage_api.setAllowScrolling(true); // Re-enable scrolling in fullPage.js
                }
            }

            // Map initialization function
            function initializeMap() {
                var zoomAndPan = getZoomAndPan();

                const svgMapBrandElement = document.getElementById('svgMapBrand');
                if (!svgMapBrandElement) return;

                svgMapBrandElement.innerHTML = ''; // Clear any existing map content

                try {
                    var svgMapBrand = new svgMap({
                        targetElementID: 'svgMapBrand',
                        data: {
                            data: {
                                brand: {}
                            },
                            applyData: 'brand',
                            values: {
                                EE: { brand: 'Brand Estonia' },
                                LV: { brand: 'Brand Latvia' },
                                LT: { brand: 'Brand Lithuania' },
                                SE: { brand: 'Brand Sweden' },
                                FI: { brand: 'Brand Finland' },
                            }
                        },
                        colorMin: '#E2E2E2',
                        colorMax: '#b09c86',
                        colorNoData: '#E2E2E2',
                        initialZoom: zoomAndPan.zoom,
                        initialPan: {
                            x: zoomAndPan.panX,
                            y: zoomAndPan.panY,
                        },
                        mouseWheelZoomEnabled: true,
                        mouseWheelZoomWithKey: true,
                        onGetTooltip: function (tooltipDiv, countryID, countryValues) {
                            // Tooltip customization
                        }
                    });
                } catch (error) {
                    console.error("Map initialization error: ", error);
                }
            }

            // Responsive zoom and pan settings
            function getZoomAndPan() {
                var screenWidth = window.innerWidth;

                if (screenWidth > 1200) {
                    return { zoom: 10, panX: 540, panY: 75 };
                } else if (screenWidth > 1000) {
                    return { zoom: 9, panX: 540, panY: 70 };
                } else if (screenWidth > 768) {
                    return { zoom: 9, panX: 470, panY: 63 };
                } else if (screenWidth > 248) {
                    return { zoom: 8, panX: 177, panY: 23 };
                } else {
                    return { zoom: 9, panX: 260, panY: 35 };
                }
            }

            // Reinitialize map on window resize
            window.addEventListener('resize', initializeMap);
        </script>

        <style>
            /* Style adjustments for the modal and preview */
            .map-preview img {
                cursor: pointer;
            }

            .map-modal {
                display: none; /* Hidden by default */
                position: fixed; /* Stay in place */
                top: 0;
                left: 0;
                width: 100vw; /* Full width */
                height: 100vh; /* Full height */
                background: rgba(0, 0, 0, 0.7); /* Semi-transparent background */
                justify-content: center; /* Center content */
                align-items: center; /* Center content */
                z-index: 9999; /* High z-index to overlay other content */
            }

            .map-modal-content {
                position: relative;
                width: calc(100vw - 40px);
                height: calc(100vh - 40px);
                background: white;
                display: flex;
                justify-content: center;
                align-items: center;
                box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.5);
                overflow: hidden;
            }

            .close {
                position: absolute;
                top: 15px;
                right: 20px;
                font-size: 24px;
                color: #333;
                cursor: pointer;
                z-index: 1000;
            }

            .map-preview {
                background-image: url('path/to/photo.jpg');
                background-size: cover;
                background-position: center;
                width: 100%;
                height: 300px;
                cursor: pointer;
            }
        </style>

    </div>

    <!-- fullPage.js JS -->
    <script type="text/javascript" src="https://www.unpkg.com/fullpage.js/dist/fullpage.min.js"></script>

    <!-- Initialize fullPage.js -->
    <script type="text/javascript">
        var myFullpage = new fullpage("#fullpage", {
            anchors: ['section1', 'section2', 'section3', 'section4', 'section5', 'section6', 'section7', 'section8'],
            licenseKey: "X14MK-GWEQK-9K86I-5JO8I-LJNKO",
            autoScrolling: true,
            slidesNavigation: false,
            controlArrows: true,
            loopHorizontal: true,
            fitToSection: true,
            verticalCentered: true,
            responsiveWidth: 1025,
            keyboardScrolling: true,
            fadingEffect: true,
        });
    </script>

</body>

</html>
